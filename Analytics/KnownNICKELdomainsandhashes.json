{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
"resources": [
        {
            "id": "/subscriptions/1c61ccbf-70b3-45a3-a1fb-848ce46d70a6/resourceGroups/cxe-malowe/providers/Microsoft.OperationalInsights/workspaces/malowe/providers/Microsoft.SecurityInsights/alertRules/3d6ccebc-2586-4ea3-b6b9-8c83edf6fd91",
            "name": "3d6ccebc-2586-4ea3-b6b9-8c83edf6fd91",
            "type": "Microsoft.SecurityInsights/alertRules",
            "kind": "Scheduled",
            "apiVersion": "2021-03-01-preview",
            "properties": {
                "displayName": "Known NICKEL domains and hashes",
                "description": "IOC domains and hash values for tools and malware used by NICKEL.  Matches domain name, hash IOCs and M365 Defender sigs related to the NICKEL activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes.",
                "severity": "High",
                "enabled": true,
                "query": "W3CIISLog| where csMethod == 'GET'| where isnotempty(csUriStem) and isnotempty(csUriQuery)| where csUriStem contains \"logoimagehandler.ashx\"| where csUriQuery contains \"codes\" and csUriQuery contains \"clazz\" and csUriQuery contains \"method\" and csUriQuery contains \"args\"| extend timestamp = TimeGenerated, IPCustomEntity = cIP, HostCustomEntity = Computer, AccountCustomEntity = csUserName",
                "queryFrequency": "P1D",
                "queryPeriod": "P1D",
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "tactics": ["CommandAndControl"],
                "alertRuleTemplateName": "9122a9cb-916b-4d98-a199-1b7b0af8d598", 
                "incidentConfiguration": {
                    "createIncident": true, 
                    "groupingConfiguration": {
                        "enabled": false, 
                    "reopenClosedIncident": false,
                    "lookbackDuration": "PT5H",
                        "entitiesMatchingMethod": "All",
                        "groupByEntities": "[]"
                     }
                },
                "eventGroupingSettings": {
                    "aggregationKind": "SingleAlert"
                }
            }
        }
    ]
}