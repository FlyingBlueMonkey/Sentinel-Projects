{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        },
     "analytic-id": {
        "type": "string",
        "defaultValue": "",
        "minLength": 1,
        "metadata": {
        "description": "Unique id for the scheduled alert rule"
      }
    }
    },
"resources": [
     {"id":"/subscriptions/1c61ccbf-70b3-45a3-a1fb-848ce46d70a6/resourceGroups/cxe-malowe/providers/Microsoft.OperationalInsights/workspaces/malowe/providers/Microsoft.SecurityInsights/alertRules/696205fd-2bf4-4b3d-8a5b-90e56863d573","name":"696205fd-2bf4-4b3d-8a5b-90e56863d573","etag":"\"3300a8a5-0000-0100-0000-61f48b180000\"","type":"Microsoft.SecurityInsights/alertRules","kind":"Scheduled","properties":{"incidentConfiguration":{"createIncident":true,"groupingConfiguration":{"enabled":true,"reopenClosedIncident":false,"lookbackDuration":"PT5H","matchingMethod":"AllEntities","groupByEntities":null,"groupByAlertDetails":null,"groupByCustomDetails":null}},"entityMappings":[{"entityType":"Account","fieldMappings":[{"identifier":"FullName","columnName":"AccountCustomEntity"}]}],"queryFrequency":"PT4H","queryPeriod":"PT4H","triggerOperator":"GreaterThan","triggerThreshold":0,"severity":"High","query":"AuditLogs| where Category =~ \"RoleManagement\"| where ActivityDisplayName has_any (\"Add eligible member to role\", \"Add member to role\")| mv-expand TargetResources| mv-expand TargetResources.modifiedProperties| extend displayName_ = tostring(TargetResources_modifiedProperties.displayName)| where displayName_ =~ \"Role.DisplayName\"| extend RoleName = tostring(parse_json(tostring(TargetResources_modifiedProperties.newValue)))| where RoleName contains \"Admin\"| extend Target = tostring(TargetResources.userPrincipalName)| summarize dcount(Target) by bin(TimeGenerated, 1h)| where dcount_Target > 9| join kind=rightsemi  (AuditLogs| where Category =~ \"RoleManagement\"| where ActivityDisplayName has_any (\"Add eligible member to role\", \"Add member to role\")| mv-expand TargetResources| mv-expand TargetResources.modifiedProperties| extend displayName_ = tostring(TargetResources_modifiedProperties.displayName)| where displayName_ =~ \"Role.DisplayName\"| extend RoleName = tostring(parse_json(tostring(TargetResources_modifiedProperties.newValue)))| where RoleName contains \"Admin\"| extend Target = tostring(TargetResources.userPrincipalName)| extend TimeWindow = bin(TimeGenerated, 1h)) on $left.TimeGenerated == $right.TimeWindow| extend AccountCustomEntity = Target","suppressionDuration":"PT5H","suppressionEnabled":false,"tactics":["PrivilegeEscalation"],"displayName":"Bulk Changes to Privileged Account Permissions","enabled":true,"description":"Identifies when changes to multiple users permissions are changed at once. Investigate immediately if not a planned change. This setting could enable an attacker access to Azure subscriptions in your environment.Ref : https://docs.microsoft.com/azure/active-directory/fundamentals/security-operations-privileged-identity-management","alertRuleTemplateName":"218f60de-c269-457a-b882-9966632b9dc6","lastModifiedUtc":"2022-01-29T00:32:24.056358Z"}}
   ]
}